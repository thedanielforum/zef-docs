---
id: rfz-zefQ
title: RFZ - zef Q
---

### Simple Transaction

The simplest form of adding new RAEs to a graph directly
```python
with Transaction(g):
    z_rufus = (instantiate(ET.Dog, g) 
                | attach[RT.Name, "Rufus"]
                | attach[RT.Color, EN.Color.Black]
              )
```


### Factored out into a function

This has nothing to do with zefDB, we simply factor out the common part into a function.

```python
def add_dog(name, color, g):
    with Transaction(g):
        return (instantiate(ET.Dog, g) 
                    | attach[RT.Name, name]
                    | attach[RT.Color, color]
                )

add_dog("Rufus", EN.Color.Black, g)
add_dog("Satan", EN.Color.White, g)
```

### Having the changes executed by the zefDB Q 

Sometimes we are executing code inside the context of a transaction and would like to declare and dispatch a function that writes data into a separate new transaction after the current one closes. This is not easily possible, especially if we are unsure if another outer context openened a transaction. To deal with these situations, we propose introducting a zefDB `Q` zefop, into which we pass a function that will be executed wihtin its own separate transaction when the queueing system decides that it is its turn. 

```python
def make_dog(name, color, g):
    def f(g):
        with Transaction(g):
            (instantiate(ET.Dog, g) 
                | attach[RT.Name, name]
                | attach[RT.Color, color]
            )
    return f

make_rufus_fct = make_dog("Rufus", EN.Color.Black, g)
make_satan_fct = make_dog("Satan", EN.Color.White, g)

# put the functions into the queue
g | Q[make_rufus_fct] | Q[make_satan_fct]
```
Optionall, one may also pass an execution priority, which determines the execution order if multiple functions are queued:
`Q[priority[0.2]][my_fct]`. The function that it takes should take the graph `g` for which the tx is opened. 

<!-- In the future one could also considering passing an execution context, e.g. whether the function passed is to be executed on a different thread or process. -->
