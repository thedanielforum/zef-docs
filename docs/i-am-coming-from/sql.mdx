---
id: sql
title: I am coming from SQL
tags: [SQL]
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import FutureFeature from "@theme/FutureFeature";

import CodeBlock from "@theme/CodeBlock";

### Project: Book Store Inventory Management

This is an simple example project where a user can check books online.
They can also order a book online, in which case the inventory will get updated, and the book count will reduce.
Users can also use filters to search for a particular book based on book name, author name, price, etc.
They can also search for books from a particular author. Admins can add books or delete books.
Here are some important queries that are used for this project.

**Creating the table**

```sql
CREATE TABLE book_details
  (
     book_name         VARCHAR(100),
     author_name       VARCHAR(100),
     book_description  VARCHAR(255),
     price             FLOAT,
     in_stock          INT,
     primary_keyword   VARCHAR(10),
     secondary_keyword VARCHAR(10),
     rating            FLOAT
  );
```

```py
from zefdb import *
from zefdb.ops import *
g = Graph()
```

:::info

In zefDB we do not need to create the table, as the power of a graph database lies in its flexibility. Adding/missing fields or fields with differing types are trivial. However, placing requirements on the database structure can also be desirable, which is covered by [spec (todo)](/).

:::

**Inserting Data**

```sql
INSERT INTO book_details
VALUES      ("let us c",
             "yashwant k.",
             "learn c programming",
             200.25,
             3,
             "c",
             "software",
             4.5);

INSERT INTO book_details
VALUES      ("let us c++",
             "yashwant k.",
             "learn c++ programming",
             230.25,
             5,
             "c++",
             "c",
             4.5);

INSERT INTO book_details
VALUES      ("head first java",
             "kathy sierra",
             "learn java programming",
             330,
             10,
             "java",
             "jvm",
             3.5);

INSERT INTO book_details
VALUES      ("java: the complete reference",
             "mc graw hill",
             "7th edition, learn java programming",
             783,
             4,
             "java",
             "javabeans",
             4);

INSERT INTO book_details
VALUES      ("thinking in java",
             "bruce eckel",
             "java programming basics",
             3000,
             5,
             "java",
             "jvm",
             4.5);
```

Method 1

```py
[
    ET.Book["book"],
    (Z["book"], RT.BookName, "let us c"),
    (Z["book"], RT.AuthorName, "yashwant k."),
    (Z["book"], RT.BookDescription, "learn c programming"),
    (Z["book"], RT.Price, 200.25),
    (Z["book"], RT.InStock, 3),
    (Z["book"], RT.PrimaryKeyword, "c"),
    (Z["book"], RT.SecondaryKeyword, "software"),
    (Z["book"], RT.Rating, 4.5),
] | transact[g] | run
```

etc...

<FutureFeature>
  In the future this will simplify a little:
  <CodeBlock>
    [ (ET.Book, [ (RT.BookName, "let us c"), (RT.AuthorName,
    "yashwant k."), (RT.BookDescription, "learn c programming"), (RT.Price,
    200.25), (RT.InStock, 3), (RT.PrimaryKeyword, "c"), (RT.SecondaryKeyword,
    "software"), (RT.Rating, 4.5), ]) ] | transact[g] | run
  </CodeBlock>
  etc...
</FutureFeature>

Method 2

```py
d = {
    'zef_type': "Book",
    'BookName': "let us c",
    'AuthorName': "yashwant k.",
    'BookDescription': "learn c programming",
    'Price': 200.25,
    'InStock': 3,
    'PrimaryKeyword': "c",
    'SecondaryKeyword': "software",
    'Rating': 4.5
}
from zefdb.tools import inject
inject(d, g)
```

etc...

Method 3

```py
data = [["let us c", "yashwant k.", "learn c programming", 200.25, 3, "c", "software", 4.5,],
["let us c++", "yashwant k.", "learn c++ programming", 230.25, 5, "c++", "c", 4.5,],
["head first java", "kathy sierra", "learn java programming", 330, 10, "java", "jvm", 3.5,],
["java: the complete reference", "mc graw hill", "7th edition, learn java programming", 783, 4, "java", "javabeans", 4,],
["thinking in java", "bruce eckel", "java programming basics", 3000, 5, "java", "jvm", 4.5,],]

rts = [RT.BookName, RT.AuthorName, RT.BookDescription, RT.Price, RT.InStock, RT.PrimaryKeyword, RT.SecondaryKeyword, RT.Rating]
from zefdb.tools import inject_tabular
inject_tabular(data, ET.Book, rts, g)
```

**Now, let's select only Java books**

```sql
SELECT *
FROM   book_details
WHERE  primary_keyword LIKE '%java%';
```

| book_name                    | author_name  | book_description                    | price | in_stock | primary_keyword | secondary_keyword | rating |
| ---------------------------- | ------------ | ----------------------------------- | ----- | -------- | --------------- | ----------------- | ------ |
| head first java              | kathy sierra | learn java programming              | 330   | 10       | java            | jvm               | 3.5    |
| java: the complete reference | mc graw hill | 7th edition, learn java programming | 783   | 4        | java            | javabeans         | 4      |
| thinking in java             | bruce eckel  | java programming basics             | 3000  | 5        | java            | jvm               | 4.5    |

```py
books = (g | now
 | all[ET.Book]
 | filter[Z >> RT.PrimaryKeyword | value | contains["java"]]
 | collect)

from zefdb.tools import interpret_rae_as_fields
@func
def to_table(dicts):
    from tabulate import tabulate
    return tabulate(dicts, headers="keys")

books | map[interpret_rae_as_fields] | to_table | run[print]
```

```
BookName                      AuthorName    BookDescription                        Price    InStock  PrimaryKeyword    SecondaryKeyword      Rating
----------------------------  ------------  -----------------------------------  -------  ---------  ----------------  ------------------  --------
head first java               kathy sierra  learn java programming                   330         10  java              jvm                      3.5
java: the complete reference  mc graw hill  7th edition, learn java programming      783          4  java              javabeans                4
thinking in java              bruce eckel   java programming basics                 3000          5  java              jvm                      4.5
```

:::info

Graph databases are more flexible than tabular relation databases. The `interpret_rae_as_fields` tool interprets all outgoing relations from an entity as its "fields", which mimics the SQL query. However, missing/additional fields or data on relations are trivial for a graph database, which has no counterpart in the SQL example.

Similarly, the `to_table` function we create here is only created here as a tool to mimic the SQL output.

:::

**Let’s select only those Java books that have a rating greater than 4**

```sql
SELECT *
FROM   book_details
WHERE  primary_keyword LIKE '%java%'
       AND rating > 4;
```

| book_name        | author_name | book_description        | price | in_stock | primary_keyword | secondary_keyword | rating |
| ---------------- | ----------- | ----------------------- | ----- | -------- | --------------- | ----------------- | ------ |
| thinking in java | bruce eckel | java programming basics | 3000  | 5        | java            | jvm               | 4.5    |

```py
books = (g | now
 | all[ET.Book]
 | filter[Z >> RT.PrimaryKeyword | value | contains["java"]]
 | filter[lambda z: z >> RT.Rating | value | collect > 4]
 | collect)

books | map[interpret_rae_as_fields] | to_table | run[print]
```

```
BookName          AuthorName    BookDescription            Price    InStock  PrimaryKeyword    SecondaryKeyword      Rating
----------------  ------------  -----------------------  -------  ---------  ----------------  ------------------  --------
thinking in java  bruce eckel   java programming basics     3000          5  java              jvm                      4.5
```

**Now, search for books based on author name**

```sql
SELECT *
FROM   book_details
WHERE  author_name LIKE '%yashwant%';
```

| book_name  | author_name | book_description      | price  | in_stock | primary_keyword | secondary_keyword | rating |
| ---------- | ----------- | --------------------- | ------ | -------- | --------------- | ----------------- | ------ |
| let us c   | yashwant k. | learn c programming   | 200.25 | 3        | c               | software          | 4.5    |
| let us c++ | yashwant k. | learn c++ programming | 230.25 | 5        | c++             | c                 | 4.5    |

```py
books = (g | now
 | all[ET.Book]
 | filter[Z >> RT.AuthorName | value | contains["yashwant"]]
 | collect)

books | map[interpret_rae_as_fields] | to_table | run[print]
```

```
BookName    AuthorName    BookDescription          Price    InStock  PrimaryKeyword    SecondaryKeyword      Rating
----------  ------------  ---------------------  -------  ---------  ----------------  ------------------  --------
let us c    yashwant k.   learn c programming     200.25          3  c                 software                 4.5
let us c++  yashwant k.   learn c++ programming   230.25          5  c++               c                        4.5
```

**Suppose a user selects the book ‘Let us C’ for purchase. After the purchase, the database has to be updated with the latest count.
For this, we have first to get the current stock and then reduce it.**

```sql
SELECT in_stock,
       book_name,
       price
FROM   book_details
WHERE  book_name = 'Let us C';

UPDATE book_details
SET    in_stock = in_stock - 1
WHERE  book_name = 'Let us C';

SELECT *
FROM   book_details
WHERE  book_name = 'Let us C';
```

| book_name | author_name | book_description    | price  | in_stock | primary_keyword | secondary_keyword | rating |
| --------- | ----------- | ------------------- | ------ | -------- | --------------- | ----------------- | ------ |
| let us c  | yashwant k. | learn c programming | 200.25 | 2        | c               | software          | 4.5    |

```py
book = (g | now
 | all[ET.Book]
 | filter[Z >> RT.BookName | value | equals["let us c"]]
 | only
 | collect)

in_stock = book >> RT.InStock | collect
(in_stock <= (value(in_stock) - 1)) | g | run

book | now | interpret_rae_as_fields | run[print]
```

```
{'BookName': 'let us c', 'AuthorName': 'yashwant k.', 'BookDescription': 'learn c programming', 'Price': 200.25, 'InStock': 2, 'PrimaryKeyword': 'c', 'SecondaryKeyword': 'software', 'Rating': 4.5}
```

**To delete books from the database that have a rating less than 4, we should write the query as**

```sql
DELETE FROM book_details
WHERE  rating < 4;
```

This will delete all the entries having book ratings less than 4.

```py
(g | now
 | all[ET.Book]
 | filter[lambda z: z >> RT.Rating | value | collect < 4]
 | for_each[terminate])
```

###### [credits to hackr.io](https://hackr.io/blog/best-sql-projects)
